<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COMPSTAT AI - Deployment Editor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg-dark: #121212;
      --card-dark: #1e1e1e;
      --text-dark: #e0e0e0;
      --border-dark: #333;
      --highlight: #e74c3c;
      --confidence-high: #51cf66;
      --confidence-med: #fcc419;
      --confidence-low: #ff6b6b;
    }
    body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 15px;
    }
    h1, h2, h3 {
      color: var(--text-dark);
    }
    section {
      margin-bottom: 20px;
    }
    .transparency-section {
      padding: 15px;
      background-color: var(--card-dark);
      border-radius: 8px;
      border: 1px solid var(--border-dark);
    }
    .transparency-section h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    .transparency-section pre {
      background-color: #2a2a2a;
      padding: 10px;
      border-radius: 4px;
      font-size: 12px;
      color: var(--text-dark);
    }
    .transparency-section p {
      font-size: 12px;
      color: var(--text-dark);
    }
    .transparency-section a {
      color: var(--highlight);
      text-decoration: none;
    }
    .transparency-section a:hover {
      text-decoration: underline;
    }
    nav ul {
      display: flex;
      gap: 15px;
      list-style: none;
      margin-bottom: 15px;
    }
    nav a {
      color: var(--highlight);
      text-decoration: none;
    }
    nav a:hover {
      text-decoration: underline;
    }
    canvas {
      max-width: 100%;
      margin-top: 10px;
    }
    .card {
      background-color: var(--card-dark);
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      padding: 15px;
      border: 1px solid var(--border-dark);
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0,0,0,0.4);
    }
    .card-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--text-dark);
      font-size: 16px;
    }
    .graph-container {
      background-color: #2a2a2a;
      border-radius: 4px;
      margin-bottom: 10px;
      border: 1px solid var(--border-dark);
    }
    button {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--border-dark);
      background-color: var(--card-dark);
      color: var(--text-dark);
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background-color: #333;
    }
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--card-dark);
      border: 1px solid var(--border-dark);
      border-radius: 8px;
      padding: 20px;
      max-width: 500px;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    .popup h3 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    .popup p {
      font-size: 14px;
      margin-bottom: 10px;
    }
    .popup button {
      margin-top: 10px;
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    select {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--border-dark);
      background-color: var(--card-dark);
      color: var(--text-dark);
      font-size: 14px;
    }
    .main-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 15px;
      height: 100%;
    }
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .officer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="Analyst.html">Analysis</a></li>
        <li><a href="deployment.html">Deployment</a></li>
      </ul>
    </nav>
    <h1>COMPSTAT AI - Deployment Editor</h1>
    <div class="filters">
      <select id="suburbFilter">
        <option value="all">All Suburbs</option>
        <option value="bronx12">Bronx - Precinct 12</option>
        <option value="brooklyn10">Brooklyn - Precinct 10</option>
      </select>
      <select id="dayFilter">
        <option value="7">Next 7 Days</option>
        <option value="14">Next 14 Days</option>
        <option value="30">Next 30 Days</option>
      </select>
    </div>
  </header>

  <section>
    <div class="card">
      <div class="card-title">Officer Assignments</div>
      <div class="officer-grid">
        <div>
          <p><strong>JD</strong></p>
          <p>Officer John Doe</p>
          <p>Badge: #7142</p>
          <p>Unit: Patrol Car 12</p>
          <p>Status: Available</p>
          <p>Last Activity: Traffic stop 15 min ago</p>
        </div>
        <div>
          <p><strong>MS</strong></p>
          <p>Officer Maria Smith</p>
          <p>Badge: #9821</p>
          <p>Unit: K9 Unit 5</p>
          <p>Status: On active call</p>
          <p>Current Assignment: Burglary in progress</p>
        </div>
        <div>
          <p><strong>TW</strong></p>
          <p>Officer Tom Wilson</p>
          <p>Badge: #3567</p>
          <p>Unit: Detective Unit 3</p>
          <p>Status: On duty (available soon)</p>
          <p>Current Assignment: Finishing paperwork</p>
        </div>
      </div>
    </div>
  </section>

  <section class="main-content">
    <div class="card">
      <div class="card-title">AI Deployment Recommendations</div>
      <select id="areaFilter">
        <option value="financial">Financial District</option>
        <option value="residential">Residential Zone</option>
      </select>
      <div id="recommendationContent">
        <p id="confidence">89% confidence</p>
        <p id="recommendation">Recommendation: 2 patrol units from 18:00-02:00</p>
        <p id="reason">Reason: Historical robbery pattern shows 73% increase during these hours</p>
        <canvas id="recommendationChart"></canvas>
        <p><a href="#">Override recommendation</a></p>
        <select>
          <option>Alternative deployment:</option>
          <option>No change</option>
          <option>Reduce to 1 unit</option>
          <option>Increase to 3 units</option>
          <option>Change hours</option>
        </select>
      </div>
      <button id="showRecExplanation">Explain</button>
    </div>
    <div class="right-column">
      <div class="card">
        <div class="card-title">AI Deployment Plan</div>
        <div class="graph-container">
          <canvas id="aiPlanChart" class="graph"></canvas>
        </div>
        <div>
          <button id="saveDeployment">Save Deployment</button>
          <button id="showPlanExplanation">Explanation</button>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Resource Allocation</div>
        <canvas id="resourceChart"></canvas>
        <p style="font-size: 12px; color: #aaa;">Note: Higher allocations in certain suburbs may indicate potential bias. Review and adjust deployments to ensure equitable distribution.</p>
      </div>
    </div>
  </section>

  <section class="transparency-section">
    <h2>Future Predictions and Data Sources</h2>
    <p>The AI generates future predictions for crime patterns and resource deployment based on the following process:</p>
    <p><strong>Prediction Formula:</strong></p>
    <p><strong>Predicted Crime Risk (PCR)</strong> = 0.5 × Historical Crime Rate (HCR) + 0.3 × Trend Momentum (TM) + 0.2 × Predictive Factors (PF)</p>
    <p>
      <strong>Historical Crime Rate (HCR)</strong>: Average crime incidents per 100,000 residents over the past 3 years (e.g., 12 robberies in Financial District).<br>
      <strong>Trend Momentum (TM)</strong>: Rate of change in crime incidents over the selected period (e.g., 5% monthly increase in robberies).<br>
      <strong>Predictive Factors (PF)</strong>: External variables like weather forecasts, economic projections, and community events (e.g., festivals increase foot traffic by 15%).<br>
      Confidence is calculated using a Bayesian model, combining historical variance and predictive factor reliability (e.g., 85% confidence for 7-day predictions).
    </p>
    <p><strong>Data Sources:</strong></p>
    <ul>
      <li>NYPD Historical Crime Reports (2018-2025): Primary source for crime data, weighted at 0.8.</li>
      <li>Weather Forecasts: Sourced from NOAA, weighted at 0.1, impacting crime patterns (e.g., rain increases indoor crimes).</li>
      <li>Economic Projections: Sourced from city economic reports, weighted at 0.1, correlating with property crimes.</li>
      <li>Community Feedback: Collected via surveys, influencing foot patrol recommendations.</li>
    </ul>
    <p>Predictions are adjusted based on the selected suburb and time period (7, 14, or 30 days) in the top filter, enabling tailored deployment strategies.</p>
  </section>

  <div class="overlay" id="overlay"></div>
  <div class="popup" id="recExplanationPopup">
    <h3>Recommendation Formula Explanation</h3>
    <p>The AI deployment recommendation is calculated using a weighted risk score formula:</p>
    <p><strong>Risk Score (RS)</strong> = 0.6 × Crime Rate (CR) + 0.25 × Historical Trend (HT) + 0.15 × External Factors (EF)</p>
    <p>
      <strong>Crime Rate (CR)</strong>: Normalized crime incidents per 100,000 residents (e.g., 15 robberies in Financial District for Bronx - Precinct 12).<br>
      <strong>Historical Trend (HT)</strong>: Percentage increase in crime during specific hours (e.g., 73% robbery increase from 18:00-02:00 in Financial District).<br>
      <strong>External Factors (EF)</strong>: Weather and economic indicators (e.g., rainy days increase property crimes by 10%).<br>
      Confidence is derived from the variance in historical data, with 89% indicating high reliability in the Financial District recommendation.
    </p>
    <button id="closeRecPopup">Close</button>
  </div>

  <div class="popup" id="planExplanationPopup">
    <h3>AI Deployment Plan Formula Explanation</h3>
    <p>The AI deployment plan is derived from an optimization model balancing risk and resources:</p>
    <p><strong>Deployment Score (DS)</strong> = 0.7 × Risk Score (RS) + 0.3 × Resource Availability (RA)</p>
    <p>
      <strong>Risk Score (RS)</strong>: As above, calculated per area (e.g., Financial District RS = 0.6 × 15 + 0.25 × 73 + 0.15 × 10 = 25.75).<br>
      <strong>Resource Availability (RA)</strong>: Available units normalized by precinct capacity (e.g., 10 patrol units available out of 12 in Precinct 12).<br>
      The plan optimizes deployments to maximize coverage while minimizing bias, resulting in recommendations like 2 patrol units in Financial District.
    </p>
    <button id="closePlanPopup">Close</button>
  </div>

  <script>
    // Data for AI Deployment Recommendations
    const recommendationData = {
      financial: {
        confidence: '89% confidence',
        recommendation: '2 patrol units from 18:00-02:00',
        reason: 'Historical robbery pattern shows 73% increase during these hours',
        chartData: [10, 15, 25, 30, 20, 10],
        chartLabels: ['16:00', '18:00', '20:00', '22:00', '00:00', '02:00'],
        chartLabel: 'Robbery Incidents'
      },
      residential: {
        confidence: '76% confidence',
        recommendation: 'Foot patrol rotation from 12:00-20:00',
        reason: 'Community feedback indicates need for visible presence',
        chartData: [5, 8, 12, 15, 10, 7],
        chartLabels: ['10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
        chartLabel: 'Community Feedback'
      }
    };

    // Resource Allocation Data
    const resourceData = {
      all: {
        patrol: [8, 10, 12],
        detective: [2, 3, 4],
        community: [5, 6, 8]
      },
      financial: {
        patrol: [10, 12, 14],
        detective: [3, 4, 5],
        community: [4, 5, 7]
      },
      residential: {
        patrol: [6, 8, 10],
        detective: [1, 2, 3],
        community: [6, 7, 9]
      }
    };

    // Resource Allocation Chart
    const resourceCtx = document.getElementById('resourceChart').getContext('2d');
    let resourceChart = new Chart(resourceCtx, {
      type: 'bar',
      data: {
        labels: ['Option 1', 'Option 2', 'Option 3'],
        datasets: [
          {
            label: 'Patrol Units',
            data: resourceData.all.patrol,
            backgroundColor: '#e74c3c',
          },
          {
            label: 'Detective Teams',
            data: resourceData.all.detective,
            backgroundColor: '#fcc419',
          },
          {
            label: 'Community Officers',
            data: resourceData.all.community,
            backgroundColor: '#51cf66',
          }
        ]
      },
      options: {
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { display: true } }
      }
    });

    // AI Deployment Recommendations Chart
    const recommendationCtx = document.getElementById('recommendationChart').getContext('2d');
    let recommendationChart = new Chart(recommendationCtx, {
      type: 'line',
      data: {
        labels: recommendationData.financial.chartLabels,
        datasets: [{
          label: recommendationData.financial.chartLabel,
          data: recommendationData.financial.chartData,
          borderColor: '#e74c3c',
          fill: false
        }]
      },
      options: {
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { display: false } }
      }
    });

    // Area Filter for AI Deployment Recommendations
    document.getElementById('areaFilter').addEventListener('change', function() {
      const area = this.value;
      document.getElementById('confidence').textContent = recommendationData[area].confidence;
      document.getElementById('recommendation').textContent = 'Recommendation: ' + recommendationData[area].recommendation;
      document.getElementById('reason').textContent = 'Reason: ' + recommendationData[area].reason;
      recommendationChart.data.labels = recommendationData[area].chartLabels;
      recommendationChart.data.datasets[0].label = recommendationData[area].chartLabel;
      recommendationChart.data.datasets[0].data = recommendationData[area].chartData;
      recommendationChart.update();
    });

    // Suburb Filter for Resource Allocation
    document.getElementById('suburbFilter').addEventListener('change', function() {
      const suburb = this.value === 'bronx12' ? 'financial' : 'residential'; // Map precincts to areas for demo
      resourceChart.data.datasets[0].data = resourceData[suburb].patrol;
      resourceChart.data.datasets[1].data = resourceData[suburb].detective;
      resourceChart.data.datasets[2].data = resourceData[suburb].community;
      resourceChart.update();
    });

    // AI Plan Chart
    const aiPlanCtx = document.getElementById('aiPlanChart').getContext('2d');
    new Chart(aiPlanCtx, {
      type: 'bar',
      data: {
        labels: ['Financial District', 'Residential Zone'],
        datasets: [
          {
            label: 'Patrol Units',
            data: [2, 1],
            backgroundColor: '#e74c3c',
          },
          {
            label: 'Foot Patrols',
            data: [0, 2],
            backgroundColor: '#51cf66',
          }
        ]
      },
      options: {
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { display: true } }
      }
    });

    // Popup functionality for Recommendations
    const overlay = document.getElementById('overlay');
    const recPopup = document.getElementById('recExplanationPopup');
    document.getElementById('showRecExplanation').addEventListener('click', () => {
      overlay.style.display = 'block';
      recPopup.style.display = 'block';
    });
    document.getElementById('closeRecPopup').addEventListener('click', () => {
      overlay.style.display = 'none';
      recPopup.style.display = 'none';
    });

    // Popup functionality for AI Plan
    const planPopup = document.getElementById('planExplanationPopup');
    document.getElementById('showPlanExplanation').addEventListener('click', () => {
      overlay.style.display = 'block';
      planPopup.style.display = 'block';
    });
    document.getElementById('closePlanPopup').addEventListener('click', () => {
      overlay.style.display = 'none';
      planPopup.style.display = 'none';
    });
  </script>
</body>
</html>